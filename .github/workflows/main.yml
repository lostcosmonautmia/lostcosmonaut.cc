name: Lint and Build site

on:
  pull_request:
  push:
    branches-ignore:
      - production

references:
  checkout: &checkout
    uses: actions/checkout@v2
  setup_node: &setup_node
    uses: actions/setup-node@v2
    with:
      node-version: 14.15.3
  cache: &cache
    uses: actions/cache@v2
    with:
      path: ~/.npm
      key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
      restore-keys: |
        ${{ runner.os }}-node-
  install_dependencies: &install_dependencies
    name: Install dependencies
    run: npm ci

jobs:
  lint:
    name: Lint JavaScript and stylesheets
    runs-on: ubuntu-16.04
    steps:
      - <<: *checkout
      - <<: *setup_node
      - <<: *cache
      - <<: *install_dependencies
      - name: Run lint tasks
        run: npm run lint

  build:
    name: Build site
    runs-on: ubuntu-16.04
    steps:
      - <<: *checkout
      - <<: *setup_node
      - <<: *cache
      - <<: *install_dependencies
      - name: Run build task
        run: npm run build
      - name: Test built site
        run: test -f ./public/index.html
